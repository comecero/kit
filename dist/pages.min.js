/*
Comecero Kit version: ï»¿1.0.14
Build time: 2019-05-29T23:57:27.713Z
Checksum (SHA256): f07b05f7f3d24f63ee9abcf6af8dc8f910aa8b17bb7865fc9fe0880a99db5755
https://comecero.com
https://github.com/comecero/kit
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

app.controller("CartController",["$scope","$location","CartService","GeoService","CurrencyService","SettingsService","HelperService","$document",function(t,e,a,i,r,o,c,s){t.data={},t.geoService=i,t.settings=o.get(),t.helpers=c,t.data.params={},t.data.params.expand="items.product,items.subscription_terms,customer.payment_methods,options",t.data.params.hide="items.product.formatted,items.product.prices,items.product.url,items.product.description,items.product.images.link_small,items.product.images.link_medium,items.product.images.link_large,items.product.images.link,items.product.images.filename,items.product.images.formatted,items.product.images.url,items.product.images.date_created,items.product.images.date_modified",t.data.shipping_is_billing=!0,t.data.payment_method={},t.data.card={type:"credit_card"},t.data.paypal={type:"paypal",data:{success_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/payment/review/{{payment_id}}",cancel_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/cart"}},a.get().then(function(i){i=a.fromParams(i,e),a.update(i,t.data.params,!1,!0).then(function(e){t.data.cart=e,t.data.shipping_is_billing=!c.hasShippingAddress(e.customer);var a=((e.customer||{}).payment_methods||{}).data;a&&a.length>0&&(t.data.payment_method.payment_method_id=_.find(e.customer.payment_methods.data,function(t){return 1==t.is_default}).payment_method_id)},function(e){t.data.error=e})},function(e){t.data.error=e}),t.onPaymentSuccess=function(t){switch(t.payment_method.type){case"paypal":window.location=t.response_data.redirect_url;break;default:e.path("/receipt/"+t.payment_id)}},t.$watch("data.error",function(e,a){t.data.error&&s.scrollTop(0,500)})}]),app.controller("PaymentController",["$scope","$location","$routeParams","CartService","PaymentService","SettingsService","HelperService","GeoService","$document",function(t,e,a,i,r,o,c,s,n){t.data={},t.options={};e.search();t.data.payment_id=a.id,t.data.payment_id||e.path("/cart"),t.settings=o.get(),t.helpers=c,t.geoService=s,t.data.params={},t.data.params.expand="cart.items.product,cart.items.subscription_terms,invoice.items.product,invoice.items.subscription_terms,cart.options,invoice.options",t.data.params.hide="cart.items.product.formatted,cart.items.product.prices,cart.items.product.url,cart.items.product.description,cart.items.product.images.link_small,cart.items.product.images.link_medium,cart.items.product.images.link_large,cart.items.product.images.link,cart.items.product.images.filename,cart.items.product.images.formatted,cart.items.product.images.url,cart.items.product.images.date_created,cart.items.product.images.date_modified,invoice.items.product.formatted,invoice.items.product.prices,invoice.items.product.url,invoice.items.product.description,invoice.items.product.images.link_small,invoice.items.product.images.link_medium,invoice.items.product.images.link_large,invoice.items.product.images.link,invoice.items.product.images.filename,invoice.items.product.images.formatted,invoice.items.product.images.url,invoice.items.product.images.date_created,invoice.items.product.images.date_modified",t.data.saleParams={expand:utils.deDuplicateCsv(t.data.params.expand.replaceAll("cart.","").replaceAll("invoice.","")),hide:utils.deDuplicateCsv(t.data.params.hide.replaceAll("cart.","").replaceAll("invoice.",""))},r.get(t.data.payment_id,t.data.params).then(function(a){"completed"==a.status&&e.path("/receipt/"+a.payment_id),t.data.sale=a.cart,null==t.data.sale&&(t.data.sale=a.invoice),c.isRequiredCustomerField("company_name",t.data.sale.options)&&null==t.data.sale.customer.company_name&&(t.options.showCompanyName=!0),c.isRequiredCustomerField("phone",t.data.sale.options)&&null==t.data.sale.customer.phone&&(t.options.showPhone=!0)},function(e){t.data.error=e}),t.onPaymentSuccess=function(t){"initiated"==t.status?window.location.replace(t.response_data.redirect_url):e.path("/receipt/"+t.payment_id)},t.$watch("data.error",function(e,a){t.data.error&&n.scrollTop(0,500)})}]),app.controller("ProductsController",["$scope","$routeParams","$location","$document","ProductService","CartService","GeoService","CurrencyService",function(t,e,a,i,r,o,c,s){t.data={},t.geo=c.getData(),t.data.params={},t.data.params.expand="items.product,items.subscription_terms,customer.payment_methods",t.data.params.show="product_id,name,price,currency,description,images.*",t.data.params.currency=s.getCurrency(),t.data.params.formatted=!0,t.data.params.limit=50,t.data.cartParams={},t.data.cartParams.show="cart_id",r.getList(t.data.params).then(function(e){t.data.products=e},function(e){t.data.error=e}),t.onAddToCart=function(t){a.path("/cart")},t.$watch("data.error",function(e,a){t.data.error&&i.scrollTop(0,500)})}]),app.controller("ReceiptController",["$scope","$routeParams","PaymentService","SettingsService",function(t,e,a,i){t.data={};var r={};t.settings=i.get(),r.show="payment_method.*,payment_method.data.*,date_created,cart.order_id,cart.total,cart.tax,cart.currency,cart.customer.name,cart.customer.billing_address.*,cart.items.quantity,cart.items.name,cart.items.subtotal,cart.shipping_item.quantity,cart.shipping_item.name,cart.shipping_item.subtotal,cart.items.product.images.link_square,order",r.expand="payment_method,payment_method.data,cart.items.product",r.formatted=!0,a.get(e.id,r).then(function(e){t.data.payment=e,window.__conversion&&window.__conversion.recordConversion&&window.__conversion.recordConversion(e.order.order_id)},function(e){t.exception=e}),t.$watch("data.error",function(e,a){t.data.error&&$document.scrollTop(0,500)})}]);